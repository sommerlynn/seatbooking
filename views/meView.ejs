<% include header.html %>
<style>
    .item-subtitle span {
        padding: 0 1.25rem 0 0;
        font-size: 1rem;
        color: #FFFFFF;
    }

    .content-block {
        margin: 0;
        padding: 0;
    }

    .item-text {
        padding: 0.5rem 0 0 0;
    }

    .item-text span {
        color: #FFFFFF;
    }

    .list-block {
        margin: 0;
    }

    .list-block ul:before {
        height: 0;
    }

    .bar {
        /*background-color: #FFFFFF;*/
    }

    .bar:after {
        height: 0;
        background-color: #1D2025;
    }

    .bar-tab:before {
        /*background-color: #33475F;*/
    }

    .card-header {
        font-size: 0.6rem;
    }

    .card-content-inner {
        padding: 0.75rem;
        text-align: center;
    }

    .card-footer {
        color: #000000;
        background-color: #FFFFFF;
        text-align: right;
    }

    div.card-time:before {
        content: '';
        position: absolute;
        left: 0;
        right: auto;
        top: 0;
        height: 0px;
        width: 100%;
        background-color: #924A4A;
        display: block;
        z-index: 15;
        -webkit-transform-origin: 50% 100%;
        transform-origin: 50% 100%;
    }

    div.card-time {
        position: relative;
        padding: 0.5rem 0;
    }

    div.card-time-header {
        width: 20%;
        float: left;
        text-align: center;
        font-size: 0.5rem;
        color: #000000;
    }

    div.card-time-status {
        width: 20%;
        float: left;
        text-align: center;
        font-size: 0.5rem;
        line-height: 1.25rem;
        color: #000000;
    }

    .building-info {
        line-height: 1.25rem;
        padding: 0.25rem 0.75rem;
    }

    .selected-seat-info {
        line-height: 1.25rem;
        padding: 0.25rem 0.75rem;
        font-size: 0.75em;
        width: 40%;
        display: inline-block;
        font-weight: bold;
    }

    .seat-status {
        line-height: 1.25rem;
        color: #A00000;
        font-size: .75em;
        width: 50%;
        text-align: center;
        display: inline-block;
    }

    span.date-info {
        color: #A00000;
        padding: 0.25rem 0.75rem;
        line-height: 1.25rem;
        font-size: 0.75em;
    }

    span.comment-info {
        margin: 0 0 0 0.325rem;
        font-size: 0.75em;
    }

    .operation-release, .operation-leave {
        display: inline-block;
        padding: 0.1875rem 0.3125rem;
        width: 3.75rem;
        border: 0.0625rem solid #DCC6C6;
        color: #A00000;
        margin-bottom: 0.55rem;
    }

    .operation-modify-leave, .operation-finish-leave,
    .operation-cancel-leave, .operation-detail-leave {
        display: inline-block;
        padding: 0.1875rem 0.3125rem;
        width: 3.75rem;
        border: 0.0625rem solid #DCC6C6;
        color: #A00000;
        margin-bottom: 0.55rem;
    }

    .operation-approve-leave, .operation-reject-leave {
        display: inline-block;
        padding: 0.1875rem 0.3125rem;
        width: 3.75rem;
        border: 0.0625rem solid #DCC6C6;
        color: #A00000;
        text-align: center;
    }

    .left_part {
        width: 72%;
        float: left;
        line-height: 1rem;
        padding: 0.3125rem;
        font-family: 华文中宋;
        border-right: 1px dashed #332331;
        height: 4.5rem;
        background-color: #F7F7F8;
    }

    .right_part {
        width: 28%;
        float: left;
        padding: 0.55rem 0 0 0;
        text-align: center;
        background-color: #E2E1D0;
        height: 4.5rem;
    }

    .cancel {
        background: url('../images/quxiao.png') no-repeat center;
    }

    .zanli {
        background: url('../images/zanli.png') no-repeat center;
    }

    .card {
        background-color: #FFFFFF;
        color: #000000;
        height: 4.5rem;
        margin: 0 0 .2rem 0;
    }

    .date-row {

    }

    .content-block-title {
        margin: 0;
        padding: .5rem;
        background-color: #C7D6DE;
        color: #A00000;
        display: -webkit-box;
        display: -webkit-flex;
        display: flex;
    }

    .content-block-title:after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        right: auto;
        top: auto;
        height: 1px;
        width: 100%;
        background-color: #EFEFF4;
        display: block;
        z-index: 15;
        -webkit-transform-origin: 50% 100%;
        transform-origin: 50% 100%;
    }

    .content-block-title + .card {
        margin-top: 0;
    }

    .list-block .item-media {
        padding: 0;
    }

    .list-block .item-inner {
        padding: 0;
        min-height: 0;
    }

    .list-block .item-inner:after {
        height: 0px;
    }

    .item-real-info {
    }

    span.start-date-info, span.end-date-info {
        margin: 0.25rem 0.75rem;
        line-height: 1.25rem;
        font-size: 0.75em;
    }

    span.leave-status {
        color: #A00000;
        margin: 0.25rem 0.75rem;
        padding: .25rem .5rem;
        background-color: #E6DEB3;
        line-height: 1.25rem;
        font-size: 0.75em;
    }

    span.leave-reason {
        color: #A00000;
        margin: 0.25rem 0.75rem;
        line-height: 1.25rem;
        font-size: 0.75em;
    }

    .icon-list .icon {
        display: inline-block;
        box-sizing: border-box;
        width: 25%;
        text-align: center;
    }

    .icon-list .icon-circle {
        display: block;
        margin: 0 auto .45rem auto;
        width: 2rem;
        height: 2rem;
        border-radius: 10rem;
        text-align: center;
        line-height: 2rem;
        font-size: 1.3rem;
        color: #20211B;
        background-color: #E6DEB3;
    }

    .icon-list .icon-desc {
        text-align: center;
        font-size: .65rem;
        color: #666;
    }

    span.leave-important {
        text-decoration: underline;
    }

    .approve-leave-operation-list .approve-leave-operation{
        display: inline-block;
        box-sizing: border-box;
        width: 30%;
        text-align: center;
    }
</style>

<div class="page">
    <nav class="bar bar-tab">
        <a class="tab-item" id="buildingTab" href="http://www.julyangel.cn/building/<%= openid %>?ip=<%= ip %>"
           external>
            <span class="icon icon-building"></span>
            <span class="tab-label">预约座位</span>
        </a>
        <a class="tab-item" id="skyTab" href="http://www.julyangel.cn/index/<%= openid %>?ip=<%= ip %>" external>
            <span class="icon icon-star"></span>
            <span class="tab-label">七玥星空</span>
        </a>
        <a class="tab-item active" id="meTab" href="http://www.julyangel.cn/me/<%= openid %>?ip=<%= ip %>" external>
            <span class="icon icon-me"></span>
            <span class="tab-label">我的</span>
        </a>
    </nav>
    <div class="content">
        <div class="list-block media-list" style="margin: 0;">
            <ul style="padding: 0;">
                <li style="background: url('../images/headerbg.jpg') no-repeat; background-size: 100%; padding: 1.25rem">
                    <a href="#" class="item-link item-content" style="background-color: rgba(0,0,0,0.4)">
                        <div class="item-media"><img src="<%= userInfo.headimgurl.replace('/0', '/64') %>"/></div>
                        <div class="item-inner">
                            <div class="item-title-row">
                                <div class="item-title"></div>
                            </div>
                            <div class="item-subtitle">
                                <span><%= userInfo.nickname %></span><span><%= userInfo.province %></span></div>
                            <div class="item-text"><span><%= userInfo.city %></span></div>
                        </div>
                    </a>
                </li>
            </ul>
        </div>

        <div class="swiper-container" data-space-between='10' style="padding-bottom: 0">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <ul class="icon-list" style="padding: 1rem 0;">
                        <% if(userInfo.real_name == null) { %>
                        <li class="icon">
                            <a style="display: block" href="verifySheet/<%= openid %>?ip=<%= ip %>">
                                <span class="icon icon-circle icon-me"></span>
                                <span class="icon-desc">实名认证</span>
                            </a>
                        </li>
                        <% } else{ %>
                        <li class="icon">
                            <a style="display: block">
                                <span class="icon icon-circle icon-me"></span>
                                <span class="icon-desc">身份信息</span>
                            </a>
                        </li>
                        <% } %>
                        <li class="icon">
                            <a style="display: block" href="/building/<%= openid %>?ip=<%= ip %>">
                                <span class="icon icon-circle icon-building"></span>
                                <span class="icon-desc">预约座位</span>
                            </a>
                        </li>
                        <li class="icon">
                            <a style="display: block" href="leaveSheet/<%= openid %>?ip=<%= ip %>">
                                <span class="icon icon-circle icon-leave-application"></span>
                                <span class="icon-desc">请假申请</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="swiper-pagination"></div>
        </div>

        <div class="content-block">

            <div class="list-block cards-list">
                <ul id="seat_tickets">
                    <!--<div class="content-block-title">
                        <div class="item-media">
                            <i class="icon icon-me"></i>
                        </div>
                        <div class="item-inner">
                            <div class="item-title">实名信息</div>
                            <div class="item-real-info"><a href="verifySheet/<%= openid %>?ip=<%= ip %>">实名认证 ></a>
                            </div>
                        </div>
                    </div>-->

                    <div class="content-block-title">
                        <div class="item-media">
                            <i class="icon icon-my-seat"></i>
                        </div>
                        <div class="item-inner">
                            <div class="item-title">我的座位</div>
                            <div class="item-real-info"><a href="/building/<%= openid %>?ip=<%= ip %>">历史座位 ></a></div>
                        </div>
                    </div>

                    <% if (userSeatOrders.length > 0) { %>

                    <% for(var index = 0; index < userSeatOrders.length; index++){ %>

                    <li class="card">
                        <div class="left_part">
                            <div class="date-row">
                                <span class="building-info"><%= userSeatOrders[index].full_name %></span>
                            </div>
                            <div class="date-row">
                                <span class="selected-seat-info"
                                      id="selectedSeatInfo">
                                     <%= userSeatOrders[index].seat_code %> 号</span>
                                <span class="seat-status">
                                    <% if (userSeatOrders[index].status == -1) { %>
                                    已取消
                                    <% } else if(userSeatOrders[index].status == 1) { %>
                                    正常
                                    <% } else if(userSeatOrders[index].status == -2) { %>
                                    系统释放
                                    <% } else if(userSeatOrders[index].status == 2) { %>
                                    <%= userSeatOrders[index].leave_time.toLocaleTimeString() %> 暂离
                                    <% } %>
                                </span>
                            </div>
                            <div class="date-row">
                                <span class="date-info"><%= userSeatOrders[index].start_time.toLocaleDateString() %></span>
                                <span class="comment-info">[当天有效 本人使用]</span>
                            </div>
                        </div>
                        <div class="right_part">
                            <div class="operation-release" id="release_<%= userSeatOrders[index].order_id %>">释放</div>
                            <div class="operation-leave" id="leave_<%= userSeatOrders[index].order_id %>">暂离</div>
                        </div>
                    </li>
                    <% } %>

                    <% } %>

                    <div class="content-block-title">
                        <div class="item-media">
                            <i class="icon icon-leave-application"></i>
                        </div>
                        <div class="item-inner">
                            <div class="item-title">我的假条</div>
                            <div class="item-real-info"><a href="leaveSheet/<%= openid %>?ip=<%= ip %>">历史假条 ></a></div>
                        </div>
                    </div>

                    <% if (leaveApplications.length > 0) { %>

                    <% for(var index = 0; index < leaveApplications.length; index++){ %>

                    <li class="card">
                        <div class="left_part">
                            <div class="date-row">
                                <span class="start-date-info">开始时间: <%= leaveApplications[index].start_time.toLocaleString() %></span>
                            </div>
                            <div class="date-row">
                                <span class="end-date-info">截止时间: <%= leaveApplications[index].end_time.toLocaleString() %></span>
                            </div>
                            <div class="date-row">

                                <% if(leaveApplications[index].status == 0){ %>
                                <span class="leave-status" style="background-color: #E6DEB3">
                                        待审核
                                </span>
                                <% } else if(leaveApplications[index].status == 1){ %>
                                <span class="leave-status" style="background-color: #E6DEB3">
                                    已批准
                                </span>
                                <% } %>

                            </div>
                        </div>
                        <div class="right_part">
                            <% if(leaveApplications[index].status == 0)    { %>
                            <div class="operation-modify-leave"
                                 id="modify_<%= leaveApplications[index].application_id %>">修改
                            </div>
                            <div class="operation-cancel-leave"
                                 id="cancel_<%= leaveApplications[index].application_id %>">撤回
                            </div>
                            <% } %>
                            <% if(leaveApplications[index].status == 1)    { %>
                            <div class="operation-detail-leave"
                                 id="detail_<%= leaveApplications[index].application_id %>">详情
                            </div>
                            <div class="operation-finish-leave"
                                 id="finish_<%= leaveApplications[index].application_id %>">销假
                            </div>
                            <% } %>
                        </div>
                    </li>

                    <% } %>

                    <% } %>

                    <% if(userInfo.manage_class_count > 0) { %>
                    <div class="content-block-title">
                        <div class="item-media">
                            <i class="icon icon-leave-application"></i>
                        </div>
                        <div class="item-inner">
                            <div class="item-title">待审假条</div>
                            <div class="item-real-info"><a href="leaveSheet/<%= openid %>?ip=<%= ip %>">已审假条 ></a></div>
                        </div>
                    </div>

                    <% for(var index = 0; index < waitForApprovedLeaveApplications.length; index++){ %>

                    <li class="card" style="height: auto; background-color: #F7F7F8">
                        <div class="card-content">
                            <div class="card-content-inner" style="text-align: justify; line-height: 1.25rem;"><span
                                        class="leave-important"><%= waitForApprovedLeaveApplications[index].applier_real_name %></span>
                                [<%= waitForApprovedLeaveApplications[index].mobile %>]
                                于
                                <span class="leave-important"><%= waitForApprovedLeaveApplications[index].start_time.toLocaleString() %></span>
                                至
                                <span class="leave-important"><%= waitForApprovedLeaveApplications[index].end_time.toLocaleString() %></span>
                                申请请假。请假<span
                                        class="leave-important">事由</span>：[<%= waitForApprovedLeaveApplications[index].application_reason %>
                                ]。请假去往<span
                                        class="leave-important">地点</span>:[<%= waitForApprovedLeaveApplications[index].address %>
                                ]。
                            </div>
                        </div>
                        <div class="card-footer" style="text-align: center; margin: 0 auto">
                            <ul class="approve-leave-operation-list" style="width: 100%">
                                <li class="approve-leave-operation">
                                    <span class="operation-reject-leave"
                                          id="detail_<%= waitForApprovedLeaveApplications[index].application_id %>">驳回
                                    </span>
                                </li>
                                <li class="approve-leave-operation">
                                    <span class="operation-approve-leave"
                                          id="detail_<%= waitForApprovedLeaveApplications[index].application_id %>">同意
                                    </span>
                                </li>
                            </ul>


                        </div>
                    </li>

                    <% } %>
                    <% } %>
                </ul>
            </div>
        </div>
    </div>
</div>

<script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
<script>
    $.config = {
        autoInit: true,
        router: false
    }
</script>
<script>
    /*$("#buildingTab").tap(function () {
     window.location.assign("http://www.julyangel.cn/building2");
     });
     $("#skyTab").tap(function () {
     window.location.assign("http://www.julyangel.cn/index");
     });
     $("#meTab").tap(function () {
     window.location.assign("http://www.julyangel.cn/me2");
     });*/

    $(document).on('click', '.operation-release', function () {
        var order_arr = this.id.split('_');
        var order_id = order_arr[1];
        $.confirm('真是一个好孩纸 不用了就是应该如此 让给其他小伙伴来用 赞一个', '释放座位',
                function () {
                    /*确定释放座位*/
                    $.showPreloader('释放座位中，请稍候...');

                    $.post('release',
                            {orderID: order_id},
                            function (response) {
                                $.hidePreloader();
                                $.alert(response);
                                window.location.reload();
                            });
                });
    });

    $(document).on('click', '.operation-leave', function () {
        var order_arr = this.id.split('_');
        var order_id = order_arr[1];
        $.confirm('暂离期间座位会为你保留两个小时 如果未能按时回座位 座位会被自动释放', '暂离',
                function () {
                    /*确定释放座位*/
                    $.showPreloader('设置暂离中，请稍候...');

                    $.post('leave',
                            {orderID: order_id},
                            function (response) {
                                $.hidePreloader();
                                $.alert(response);
                                window.location.reload();
                            });
                });
    });

    $(document).on('click', '.operation-approve-leave', function () {
        var application_arr = this.id.split('_');
        var application_id = application_arr[1];
        $.confirm('您确认要批准该请假申请吗?', '批准请假',
                function () {
                    /*确定释放座位*/
                    $.showPreloader('批准申请中，请稍候...');

                    $.post('approveLeave',
                            {
                                applicationID: application_id,
                                openid: '<%= openid %>'
                            },
                            function (response) {
                                $.hidePreloader();
                                $.alert(response);
                                window.location.reload();
                            });
                });
    });
</script>
<% include footer.html %>